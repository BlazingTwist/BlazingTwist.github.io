<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ChartTest</title>
    <script src="/js/highcharts.js"></script>
</head>
<body>
    <div style="width:100%; text-align: center; font-size: 2em; font-family: Arial,serif; display:flex; flex-direction: column;">
        <span id="consumption-text" style="margin-top: 10px;"></span>
        <span id="panel-text" style="margin-top: 10px;"></span>
    </div>
    <div id="container" style="width:100%; height:400px;">
        <script>
            let consumers = [
                {
                    name: 'pc',
                    consumption: [
                        {hours: 4, power: 80},
                        {hours: 9, power: 120},
                        {hours: 3, power: 200}
                    ]
                }, {
                    name: 'pc-display-old',
                    consumption: [
                        {hours: 16, power: 42}
                    ]
                }, {
                    name: 'pc-display-new',
                    consumption: [
                        {hours: 16, power: 18}
                    ]
                }, {
                    name: 'bett',
                    consumption: [
                        {hours: 24, power: 1}
                    ]
                }, {
                    name: 'alexa',
                    consumption: [
                        {hours: 24, power: 1.5}
                    ]
                }, {
                    name: 'bett-pc',
                    consumption: [
                        {hours: 4, power: 65}
                    ]
                }, {
                    name: 'bett-pc-display',
                    consumption: [
                        {hours: 4, power: 22}
                    ]
                }
            ]

            let plotData = [];
            for (let consumer of consumers) {
                let averageWattage = 0;
                for (let consumption of consumer.consumption) {
                    averageWattage += consumption.hours / 24 * consumption.power;
                }
                plotData.push({
                    name: consumer.name,
                    y: averageWattage
                })
            }

            plotData.sort((a, b) => b.y - a.y);

            document.addEventListener('DOMContentLoaded', function () {
                const chart = Highcharts.chart('container', {
                    chart: {
                        type: 'pie'
                    },
                    title: {
                        text: 'Power Consumption'
                    },
                    accessibility: {
                        point: {
                            valueSuffix: 'W'
                        }
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.y:.1f} W'
                            }
                        }
                    },
                    series: [{
                        name: 'Consumers',
                        colorByPoint: true,
                        data: plotData
                    }]
                })
            })

            let hourlyConsumption = plotData.reduce((sum, elem) => sum + elem.y, 0);
            document.getElementById('consumption-text').innerText = (
                "Total average hourly consumption: "
                + (Math.round(hourlyConsumption * 10) / 10)
                + " W"
            )
            document.getElementById('panel-text').innerText = (
                "Minimum solar panel rating: "
                + (Math.round(hourlyConsumption / 5 * 24 * 10) / 10)
                + " W"
            )
        </script>
    </div>
    <div id="container2" style="width:100%; height:400px;">
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const chart = Highcharts.chart('container2', {
                    chart: {
                        type: 'bellcurve'
                    },
                    title: {
                        text: 'step distribution'
                    },
                    accessibility: {
                        point: {
                            valueSuffix: 'steps'
                        }
                    },
                    plotOptions: {
                        bellcurve: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.y:.1f} steps'
                            }
                        }
                    },
                    series: [{
                        name: 'MinFirst',
                        colorByPoint: true,
                        data: plotData
                    }]
                })
            })

            let hourlyConsumption = plotData.reduce((sum, elem) => sum + elem.y, 0);
            document.getElementById('consumption-text').innerText = (
                "Total average hourly consumption: "
                + (Math.round(hourlyConsumption * 10) / 10)
                + " W"
            )
            document.getElementById('panel-text').innerText = (
                "Minimum solar panel rating: "
                + (Math.round(hourlyConsumption / 5 * 24 * 10) / 10)
                + " W"
            )
        </script>
    </div>
</body>
</html>